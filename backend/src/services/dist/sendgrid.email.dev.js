'use strict';

var sgMail = require('@sendgrid/mail');

sgMail.setApiKey(process.env.SENDGRID_API_KEY);
var frontEndUrl = process.env.NODE_ENV === 'development' ? 'http://localhost:3000' : 'https://www.sharingan.me';

var sendInvitationEmail = function sendInvitationEmail(recipientEmail, code, projectName, orgName) {
  var data;
  return regeneratorRuntime.async(function sendInvitationEmail$(_context) {
    while (1) {
      switch ((_context.prev = _context.next)) {
        case 0:
          data = {
            from: 'Join@bluetape.io',
            to: recipientEmail,
            text: 'and easy to do anywhere, even with Node.js',
            subject: 'You have been invited!',
            html: '<!doctype html>\n      <html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">\n        <head>\n          <title> </title>\n          <meta http-equiv="X-UA-Compatible" content="IE=edge">\n          <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n          <meta name="viewport" content="width=device-width, initial-scale=1">\n          <style type="text/css">\n            #outlook a {\n              padding: 0;\n            }\n            body {\n              margin: 0;\n              padding: 0;\n              -webkit-text-size-adjust: 100%;\n              -ms-text-size-adjust: 100%;\n            }\n            table,\n            td {\n              border-collapse: collapse;\n              mso-table-lspace: 0pt;\n              mso-table-rspace: 0pt;\n            }\n            a{\n              font-weight: bold;\n              color: blue;\n            }\n            p {\n              display: block;\n              margin: 13px 0;\n            }\n          </style>\n          <link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700" rel="stylesheet" type="text/css">\n          <style type="text/css">\n            @import url(https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700);\n          </style>\n          <style type="text/css">\n            @media only screen and (min-width:480px) {\n              .mj-column-per-100 {\n                width: 100% !important;\n                max-width: 100%;\n              }\n            }\n          </style>\n          <style type="text/css">\n            @media only screen and (max-width:480px) {\n              table.mj-full-width-mobile {\n                width: 100% !important;\n              }\n              td.mj-full-width-mobile {\n                width: auto !important;\n              }\n            }\n          </style>\n        </head>\n        <body>\n          <div style="">\n            <div style="margin:0px auto;max-width:600px;">\n              <table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width:100%;">\n                <tbody>\n                  <tr>\n                    <td style="direction:ltr;font-size:0px;padding:20px 0;text-align:center;">\n                      <div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%;">\n                        <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top;" width="100%">\n                          <tr>\n                            <td align="center" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <div style="font-family:Avenir;font-size:22px;font-weight:bold;line-height:1;text-align:left;color:#000000;">You\'ve been invited to {{project}}</div>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:16px;line-height:2;text-align:left;color:#000000;">Use <span style="font-weight:700;font-size:18px;">{{ORGANIZATION}}</span> as the organization name and the code below to create your Sharingan account <a href=\''
              .concat(
                frontEndUrl,
                '/signup\'>here</a></div>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td align="left" vertical-align="middle" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <table border="0" cellpadding="0" cellspacing="0" role="presentation">\n                                <tr>\n                                  <td align="center" role="presentation">\n                                      <p  style="font-size: 28px; font-weight: 700;">\n                      {{CODE}}\n                                  </p> </td>\n                                </tr>\n                              </table>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <p style="border-top:solid 4px #ffffff;font-size:1px;margin:0px auto;width:100%;"> </p>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:16px;line-height:1;text-align:left;color:#000000;">Regards,</div>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:13px;line-height:1;text-align:left;color:#000000;">The <b>Sharingan</b> Team</div>\n                            </td>\n                          </tr>\n                        </table>\n                      </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n            <div style="margin:0px auto;max-width:600px;">\n              <table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width:100%;">\n                <tbody>\n                  <tr>\n                    <td style="direction:ltr;font-size:0px;padding:20px 0;text-align:center;">\n                      <div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%;">\n                        <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top;" width="100%">\n                          <tr>\n                            <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:13px;line-height:1;text-align:left;color:#000000;">\n                                <small>This email can\'t receive replies.</small>\n                              </div>\n                            </td>\n                          </tr>\n                        </table>\n                      </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </body>\n      </html>'
              )
              .replace('{{CODE}}', code)
              .replace('{{ORGANIZATION}}', orgName)
              .replace('{{project}}', projectName),
          };
          _context.next = 3;
          return regeneratorRuntime.awrap(mg.messages().send(data));

        case 3:
        case 'end':
          return _context.stop();
      }
    }
  });
};

var sendResetPasswordEmail = function sendResetPasswordEmail(recipientEmail, token) {
  var data;
  return regeneratorRuntime.async(function sendResetPasswordEmail$(_context2) {
    while (1) {
      switch ((_context2.prev = _context2.next)) {
        case 0:
          data = {
            from: 'Join@bluetape.io',
            text: 'and easy to do anywhere, even with Node.js',
            to: recipientEmail,
            subject: 'Request to Reset Password',
            html: '<!doctype html>\n    <html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">\n      <head>\n        <title> </title>\n        <meta http-equiv="X-UA-Compatible" content="IE=edge">\n        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1">\n        <style type="text/css">\n          #outlook a {\n            padding: 0;\n          }\n          body {\n            margin: 0;\n            padding: 0;\n            -webkit-text-size-adjust: 100%;\n            -ms-text-size-adjust: 100%;\n          }\n          table,\n          td {\n            border-collapse: collapse;\n            mso-table-lspace: 0pt;\n            mso-table-rspace: 0pt;\n          }\n          a{\n            font-weight: bold;\n            color: blue;\n          }\n          p {\n            display: block;\n            margin: 13px 0;\n          }\n        </style>\n        <link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700" rel="stylesheet" type="text/css">\n        <style type="text/css">\n          @import url(https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700);\n        </style>\n        <style type="text/css">\n          @media only screen and (min-width:480px) {\n            .mj-column-per-100 {\n              width: 100% !important;\n              max-width: 100%;\n            }\n          }\n        </style>\n        <style type="text/css">\n          @media only screen and (max-width:480px) {\n            table.mj-full-width-mobile {\n              width: 100% !important;\n            }\n            td.mj-full-width-mobile {\n              width: auto !important;\n            }\n          }\n        </style>\n      </head>\n      <body>\n        <div style="">\n          <div style="margin:0px auto;max-width:600px;">\n            <table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width:100%;">\n              <tbody>\n                <tr>\n                  <td style="direction:ltr;font-size:0px;padding:20px 0;text-align:center;">\n                    <div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%;">\n                      <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top;" width="100%">\n                        <tr>\n                          <td align="center" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                            <div style="font-family:Avenir;font-size:22px;font-weight:bold;line-height:1;text-align:left;color:#000000;">Upon Your Request</div>\n                          </td>\n                        </tr>\n                        <tr>\n                          <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                            <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:16px;line-height:2;text-align:left;color:#000000;">Click <a href=\''
              .concat(
                frontEndUrl,
                '/reset_pass/{{token}}\'>here</a> to reset your password. This reset link will expire in 30 minutes</div>\n                          </td>\n                        </tr>\n                        <tr>\n                          <td style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                            <p style="border-top:solid 4px #ffffff;font-size:1px;margin:0px auto;width:100%;"> </p>\n                          </td>\n                        </tr>\n                        <tr>\n                          <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                            <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:16px;line-height:1;text-align:left;color:#000000;">Regards,</div>\n                          </td>\n                        </tr>\n                        <tr>\n                          <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                            <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:13px;line-height:1;text-align:left;color:#000000;">The <b>Sharingan</b> Team</div>\n                          </td>\n                        </tr>\n                      </table>\n                    </div>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n          <div style="margin:0px auto;max-width:600px;">\n            <table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width:100%;">\n              <tbody>\n                <tr>\n                  <td style="direction:ltr;font-size:0px;padding:20px 0;text-align:center;">\n                    <div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%;">\n                      <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top;" width="100%">\n                        <tr>\n                          <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                            <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:13px;line-height:1;text-align:left;color:#000000;">\n                              <small>This email can\'t receive replies.</small>\n                            </div>\n                          </td>\n                        </tr>\n                      </table>\n                    </div>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </body>\n    </html>'
              )
              .replace('{{token}}', token),
          };
          sgMail
            .send(msg)
            .then(function () {
              console.log('Email sent');
            })
            ['catch'](function (error) {
              console.error(error);
            });

        case 2:
        case 'end':
          return _context2.stop();
      }
    }
  });
};

var sendVerificationEmail = function sendVerificationEmail(recipientEmail, token) {
  var data;
  return regeneratorRuntime.async(function sendVerificationEmail$(_context3) {
    while (1) {
      switch ((_context3.prev = _context3.next)) {
        case 0:
          data = {
            from: 'Andrew@bluetape.io',
            to: recipientEmail,
            subject: 'Verify Your Account',
            html: '<!doctype html>\n      <html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">\n        <head>\n          <title> </title>\n          <meta http-equiv="X-UA-Compatible" content="IE=edge">\n          <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n          <meta name="viewport" content="width=device-width, initial-scale=1">\n          <style type="text/css">\n            #outlook a {\n              padding: 0;\n            }\n            body {\n              margin: 0;\n              padding: 0;\n              -webkit-text-size-adjust: 100%;\n              -ms-text-size-adjust: 100%;\n            }\n            table,\n            td {\n              border-collapse: collapse;\n              mso-table-lspace: 0pt;\n              mso-table-rspace: 0pt;\n            }\n            a{\n              font-weight: bold;\n              color: blue;\n            } \n            p {\n              display: block;\n              margin: 13px 0;\n            }\n          </style>\n          <link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700" rel="stylesheet" type="text/css">\n          <style type="text/css">\n            @import url(https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700);\n          </style>\n          <style type="text/css">\n            @media only screen and (min-width:480px) {\n              .mj-column-per-100 {\n                width: 100% !important;\n                max-width: 100%;\n              }\n            }\n          </style>\n          <style type="text/css">\n            @media only screen and (max-width:480px) {\n              table.mj-full-width-mobile {\n                width: 100% !important;\n              }\n              td.mj-full-width-mobile {\n                width: auto !important;\n              }\n            }\n          </style>\n        </head>\n        <body>\n          <div style="">\n            <div style="margin:0px auto;max-width:600px;">\n              <table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width:100%;">\n                <tbody>\n                  <tr>\n                    <td style="direction:ltr;font-size:0px;padding:20px 0;text-align:center;">\n                      <div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%;">\n                        <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top;" width="100%">\n                          <tr>\n                            <td align="center" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <div style="font-family:Avenir;font-size:22px;font-weight:bold;line-height:1;text-align:left;color:#000000;">Verify You Account</div>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:16px;line-height:2;text-align:left;color:#000000;">Click <a href=\''
              .concat(
                frontEndUrl,
                '/verify_account/{{token}}\'>here</a></div>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <p style="border-top:solid 4px #ffffff;font-size:1px;margin:0px auto;width:100%;"> </p>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:16px;line-height:1;text-align:left;color:#000000;">Regards,</div>\n                            </td>\n                          </tr>\n                          <tr>\n                            <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:13px;line-height:1;text-align:left;color:#000000;">The <b>Sharingan</b> Team</div>\n                            </td>\n                          </tr>\n                        </table>\n                      </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n            <div style="margin:0px auto;max-width:600px;">\n              <table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width:100%;">\n                <tbody>\n                  <tr>\n                    <td style="direction:ltr;font-size:0px;padding:20px 0;text-align:center;">\n                      <div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%;">\n                        <table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top;" width="100%">\n                          <tr>\n                            <td align="left" style="font-size:0px;padding:10px 25px;word-break:break-word;">\n                              <div style="font-family:Ubuntu, Helvetica, Arial, sans-serif;font-size:13px;line-height:1;text-align:left;color:#000000;">\n                                <small>This email can\'t receive replies.</small>\n                              </div>\n                            </td>\n                          </tr>\n                        </table>\n                      </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </body>\n      </html>'
              )
              .replace('{{token}}', token),
          };
          _context3.next = 3;
          return regeneratorRuntime.awrap(mg.messages().send(data));

        case 3:
        case 'end':
          return _context3.stop();
      }
    }
  });
};

module.exports = {
  sendResetPasswordEmail: sendResetPasswordEmail,
  sendInvitationEmail: sendInvitationEmail,
  sendVerificationEmail: sendVerificationEmail,
};
